[project]
name = "sasvi"

channels = ["conda-forge", "pytorch", "nvidia"]
patforms = ["linux-64"]

[system-requirements]
cuda = "12"

[dependencies]
# Python version (from README: python=3.11)
python = "3.11.*"
pip = ">=24.0"

# PyTorch with CUDA support (from README: torch>=2.3.1, torchvision>=0.18.1)
# Updated to match your system's CUDA 12.2
pytorch = ">=2.3.1"
torchvision = ">=0.18.1"
pytorch-cuda = "12.2"

# ===== From requirements.txt =====
# numpy==1.26.3
numpy = "1.26.3"

# scikit-image==0.22.0
scikit-image = "0.22.0"

# matplotlib
matplotlib = ">=3.7.0"

# pandas
pandas = ">=2.0.0"

# tqdm
tqdm = ">=4.65.0"

# natsort
natsort = ">=8.4.0"

# ===== Additional dependencies for the project =====
# Required for video processing
ffmpeg = ">=6.0"

# Required for jpeg4py (libjpeg-turbo backend)
libjpeg-turbo = ">=2.1.0"

# OpenCV for image processing
opencv = ">=4.8.0"

# PyYAML for config files
pyyaml = ">=6.0"

# Hydra for SAM2 configs
hydra-core = ">=1.3.0"

# scipy (commonly needed, dependency of scikit-image)
scipy = ">=1.10.0"

# pillow for image I/O
pillow = ">=10.0.0"

[pypi-dependencies]
# ===== From requirements.txt =====
# albumentations==1.3.1 (not on conda-forge with this exact version)
albumentations = "==1.3.1"

# jpeg4py (Python bindings for libjpeg-turbo, not on conda)
jpeg4py = "*"

# torchprofile (not on conda)
torchprofile = "*"

# ===== Detectron2 for Mask R-CNN, DETR, Mask2Former overseers =====
# Pre-built wheel for CUDA 12.1 + PyTorch 2.3 + Python 3.11
# (CUDA 12.1 wheels work fine with CUDA 12.2 drivers)
detectron2 = { url = "https://dl.fbaipublicfiles.com/detectron2/wheels/cu121/torch2.3/detectron2-0.6%2Bcu121-cp311-cp311-linux_x86_64.whl" }

# ===== Additional PyPI packages =====
# For evaluation metrics
pycocotools = ">=2.0.7"

# timm for vision transformer backbones (used by Mask2Former)
timm = ">=0.9.0"

# einops for tensor operations
einops = ">=0.7.0"

# imageio for video I/O
imageio = ">=2.31.0"
imageio-ffmpeg = ">=0.4.8"

[tasks]
# ===== Setup Tasks =====
# Clone SASVi repository
clone-sasvi = "git clone https://github.com/MECLabTUDA/SASVi.git sasvi"

# Clone SDS_Playground repository (required dependency)
clone-sds-playground = "git clone https://github.com/MECLabTUDA/SDS_Playground.git sds_playground"

# Install SDS_Playground as editable package
install-sds-playground = { cmd = "pip install -e sds_playground/", depends-on = ["clone-sds-playground"] }

# Install SAM2 from the bundled source in SASVi
install-sam2 = { cmd = "cd sasvi/src/sam2 && pip install -e .", depends-on = ["clone-sasvi"] }

# Download SAM2 model checkpoints
download-sam2-checkpoints = { cmd = "cd sasvi/src/sam2/checkpoints && bash download_ckpts.sh", depends-on = ["install-sam2"] }

# Full setup: runs all installation steps in order
setup = { depends-on = ["clone-sasvi", "install-sds-playground", "install-sam2", "download-sam2-checkpoints"] }

test = {cmd = "python3 ./src/sam2/test.py", depends-on=["setup"]}
process_cholegsec8k = {cmd = "python3 forked_SASVi/cholecseg8k_preprocessing.py", depends-on=["test"]}