[workspace]
name = "sasvi"
channels = ["conda-forge", "pytorch", "nvidia"]
platforms = ["linux-64"]

[system-requirements]
cuda = "12"

[dependencies]
python = "3.11.*"
pip = ">=24.0"

# PyTorch - use 12.1 (works fine with your 12.2 driver)
pytorch = ">=2.3.1"
torchvision = ">=0.18.1"
pytorch-cuda = "12.1"

# From requirements.txt (with correct version syntax)
numpy = "==1.26.3"
scikit-image = "==0.22.0"
matplotlib = ">=3.7.0"
pandas = ">=2.0.0"
tqdm = ">=4.65.0"
natsort = ">=8.4.0"

# Additional dependencies
ffmpeg = ">=6.0"
libjpeg-turbo = ">=2.1.0"
opencv = ">=4.8.0"
pyyaml = ">=6.0"
hydra-core = ">=1.3.0"
scipy = ">=1.10.0"
pillow = ">=10.0.0"

[pypi-dependencies]
albumentations = "==1.3.1"
jpeg4py = "*"
torchprofile = "*"
detectron2 = { url = "https://dl.fbaipublicfiles.com/detectron2/wheels/cu121/torch2.3/detectron2-0.6%2Bcu121-cp311-cp311-linux_x86_64.whl" }
pycocotools = ">=2.0.7"
timm = ">=0.9.0"
einops = ">=0.7.0"
imageio = ">=2.31.0"
imageio-ffmpeg = ">=0.4.8"

[tasks]
# ===== Setup Tasks =====
# Clone SASVi repository
clone-sasvi = "git clone https://github.com/MECLabTUDA/SASVi.git sasvi"

# Clone SDS_Playground repository (required dependency)
clone-sds-playground = "git clone https://github.com/MECLabTUDA/SDS_Playground.git sds_playground"

# Install SDS_Playground as editable package
install-sds-playground = { cmd = "pip install -e sds_playground/", depends-on = ["clone-sds-playground"] }

# Install SAM2 from the bundled source in SASVi
install-sam2 = { cmd = "cd sasvi/src/sam2 && pip install -e .", depends-on = ["clone-sasvi"] }

# Download SAM2 model checkpoints
download-sam2-checkpoints = { cmd = "cd sasvi/src/sam2/checkpoints && bash download_ckpts.sh", depends-on = ["install-sam2"] }

# Full setup: runs all installation steps in order
setup = { depends-on = ["clone-sasvi", "install-sds-playground", "install-sam2", "download-sam2-checkpoints"] }

test = {cmd = "python3 ./src/sam2/test.py", depends-on=["setup"]}
process_cholegsec8k = {cmd = "python3 forked_SASVi/cholecseg8k_preprocessing.py", depends-on=["test"]}